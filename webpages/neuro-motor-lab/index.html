<!DOCTYPE html>
<html lang="en" class="scroll-smooth scroll-pt-20">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Neuro-Motor Lab: Dynamics & Control</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Chosen Palette: Warm Scientific (Stone/Teal/Amber) -->
    <!-- Application Structure Plan: 
         1. Hero Section: Sets the stage - The Brain vs. The Environment.
         2. Theory Comparator: Interactive section to contrast Information Processing vs. Ecological Dynamics.
         3. The Learning Sweet Spot: Interactive Chart.js graph.
         4. The Motor Lab (Simulation): A custom Canvas-based game to simulate 'visuomotor rotation'.
         (Converted to a single scrollable page for continuous reading/interaction flow).
    -->
    
    <!-- Visualization & Content Choices:
         1. Concept Cards: HTML/Tailwind Grid -> Goal: Compare theories cleanly without clutter.
         2. Learning Curve Chart: Chart.js Line Chart -> Goal: Visualize the non-linear relationship between difficulty and learning.
         3. Adaptation Sim: HTML5 Canvas -> Goal: Experiential learning of 'internal models'. Users physically adapt to a rotated cursor. NO SVG used.
    -->

    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        stone: {
                            50: '#fafaf9',
                            100: '#f5f5f4',
                            200: '#e7e5e4',
                            800: '#292524',
                            900: '#1c1917',
                        },
                        teal: {
                            600: '#0d9488',
                            700: '#0f766e',
                            800: '#115e59',
                        },
                        amber: {
                            400: '#fbbf24',
                            500: '#f59e0b',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #fafaf9; /* stone-50 */
            color: #292524; /* stone-800 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            height: 400px;
            max-height: 400px;
        }
        .canvas-game-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            height: 500px;
            max-height: 500px;
            background-color: #e7e5e4;
            border-radius: 12px;
            overflow: hidden;
            cursor: crosshair;
            touch-action: none;
        }
        .nav-active {
            border-bottom: 2px solid #0d9488;
            color: #0f766e !important;
            font-weight: 600;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .btn-primary {
            background-color: #0d9488;
            color: white;
            padding: 0.5rem 1.5rem;
            border-radius: 9999px;
            transition: all 0.2s;
        }
        .btn-primary:hover {
            background-color: #0f766e;
        }
    </style>
</head>
<body class="antialiased min-h-screen flex flex-col font-sans">

    <!-- Navigation -->
    <nav class="bg-white/95 backdrop-blur border-b border-stone-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <span class="text-xl font-bold text-stone-900 tracking-tight">Neuro<span class="text-teal-600">Motor</span> Lab</span>
                </div>
                <div class="hidden md:flex space-x-8 items-center" id="nav-links">
                    <a href="#home" class="nav-btn nav-active px-3 py-2 text-sm font-medium transition-colors" data-target="home">Overview</a>
                    <a href="#theories" class="nav-btn text-stone-500 hover:text-stone-900 px-3 py-2 text-sm font-medium transition-colors" data-target="theories">Theories</a>
                    <a href="#sweetspot" class="nav-btn text-stone-500 hover:text-stone-900 px-3 py-2 text-sm font-medium transition-colors" data-target="sweetspot">Learning Rate</a>
                    <a href="#simulation" class="nav-btn text-stone-500 hover:text-stone-900 px-3 py-2 text-sm font-medium transition-colors" data-target="simulation">Adaptation Sim</a>
                </div>
                <!-- Mobile menu button -->
                <div class="flex items-center md:hidden">
                    <button onclick="toggleMobileMenu()" class="text-stone-500 hover:text-stone-900 p-2">
                        Menu
                    </button>
                </div>
            </div>
        </div>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-stone-200 p-4 absolute w-full shadow-lg">
             <a href="#home" onclick="toggleMobileMenu()" class="block w-full text-left py-3 text-stone-700 font-medium border-b border-stone-100">Overview</a>
             <a href="#theories" onclick="toggleMobileMenu()" class="block w-full text-left py-3 text-stone-700 font-medium border-b border-stone-100">Theories</a>
             <a href="#sweetspot" onclick="toggleMobileMenu()" class="block w-full text-left py-3 text-stone-700 font-medium border-b border-stone-100">Learning Rate</a>
             <a href="#simulation" onclick="toggleMobileMenu()" class="block w-full text-left py-3 text-stone-700 font-medium">Adaptation Sim</a>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="flex-grow w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

        <!-- Section 1: Hero / Overview -->
        <section id="home" class="page-section min-h-[80vh] flex flex-col justify-center animate-fade-in py-12 border-b border-stone-200">
            <div class="text-center max-w-3xl mx-auto">
                <h1 class="text-4xl md:text-6xl font-extrabold text-stone-900 mb-6 leading-tight">
                    How We Move: <br/><span class="text-teal-600">Prediction</span> vs. <span class="text-amber-500">Emergence</span>
                </h1>
                <p class="text-lg md:text-xl text-stone-600 mb-10 leading-relaxed">
                    Based on the research of <strong>Professor Reza Shadmehr</strong> (Johns Hopkins) and the principles of <strong>Ecological Dynamics</strong>. Explore the conflict and convergence between the brain as a "computer" that builds internal models, and the body as a dynamic system interacting with its environment.
                </p>
                <div class="flex justify-center gap-4">
                    <a href="#theories" class="btn-primary shadow-lg transform transition hover:scale-105 inline-block">Start Learning</a>
                    <a href="#simulation" class="bg-white text-stone-700 border border-stone-300 px-6 py-2 rounded-full hover:bg-stone-50 transition inline-block">Try Simulation</a>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-20">
                <div class="bg-white p-6 rounded-xl shadow-sm border border-stone-100 card-hover">
                    <div class="text-teal-600 text-3xl mb-4">üß†</div>
                    <h3 class="font-bold text-lg mb-2 text-stone-900">Internal Models</h3>
                    <p class="text-stone-600 text-sm leading-relaxed">Shadmehr's work suggests the Cerebellum predicts sensory consequences of movements. We learn by correcting "Prediction Errors".</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm border border-stone-100 card-hover">
                    <div class="text-amber-500 text-3xl mb-4">üåø</div>
                    <h3 class="font-bold text-lg mb-2 text-stone-900">Ecological Dynamics</h3>
                    <p class="text-stone-600 text-sm leading-relaxed">Movement emerges from the interaction of the organism, the task, and the environment. Action is coupled directly to perception.</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm border border-stone-100 card-hover">
                    <div class="text-stone-700 text-3xl mb-4">üéØ</div>
                    <h3 class="font-bold text-lg mb-2 text-stone-900">The "Sweet Spot"</h3>
                    <p class="text-stone-600 text-sm leading-relaxed">Learning is maximized not when we are perfect, but when we make errors about 15-20% of the time (The 85% Rule).</p>
                </div>
            </div>
        </section>

        <!-- Section 2: Theories Comparison -->
        <section id="theories" class="page-section py-20 border-b border-stone-200">
            <div class="mb-10 text-center max-w-3xl mx-auto">
                <h2 class="text-3xl md:text-4xl font-bold text-stone-900 mb-6">Two Views of Motor Control</h2>
                <p class="text-lg text-stone-600">
                    Historically, neuroscience viewed the brain as a processor (Input ‚Üí Process ‚Üí Output). Ecological psychology views the brain as a tuner (Attuning to Environmental Affordances). Toggle the switch below to see how they interpret the same action: <strong>Catching a Fly Ball.</strong>
                </p>
            </div>

            <!-- Interactive Toggle Switch -->
            <div class="flex justify-center mb-10">
                <div class="bg-stone-200 p-1.5 rounded-full inline-flex shadow-inner">
                    <button onclick="switchTheory('computational')" id="btn-comp" class="px-8 py-3 rounded-full text-sm md:text-base font-semibold shadow-sm bg-white text-teal-700 transition-all">Computational (Shadmehr)</button>
                    <button onclick="switchTheory('ecological')" id="btn-eco" class="px-8 py-3 rounded-full text-sm md:text-base font-semibold text-stone-500 hover:text-stone-700 transition-all">Ecological Dynamics</button>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-xl border border-stone-100 overflow-hidden transition-all duration-500 max-w-5xl mx-auto" id="theory-content">
                <div class="grid grid-cols-1 md:grid-cols-5">
                    <div class="p-8 bg-stone-50 flex flex-col justify-center items-center border-b md:border-b-0 md:border-r border-stone-200 md:col-span-2">
                        <div id="theory-icon" class="text-7xl mb-6 transition-transform duration-500">üñ•Ô∏è</div>
                        <h3 id="theory-title" class="text-2xl md:text-3xl font-bold text-stone-800 mb-2 text-center">Information Processing</h3>
                        <p id="theory-subtitle" class="text-teal-600 font-medium text-center">The Brain as a Simulator</p>
                    </div>
                    <div class="p-8 md:p-12 md:col-span-3 flex items-center">
                        <ul class="space-y-6 text-lg" id="theory-points">
                            <!-- Populated by JS -->
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 3: The Learning Sweet Spot -->
        <section id="sweetspot" class="page-section py-20 border-b border-stone-200">
            <div class="mb-10 text-center max-w-4xl mx-auto">
                <h2 class="text-3xl md:text-4xl font-bold text-stone-900 mb-6">The Mathematics of Learning</h2>
                <p class="text-lg text-stone-600 mb-6">
                    Reza Shadmehr's research indicates that learning is an error-driven process. The cerebellum updates our "internal model" based on the difference between what we <em>predicted</em> would happen and what <em>actually</em> happened.
                </p>
                <div class="bg-amber-50 border border-amber-200 text-amber-900 p-4 rounded-lg inline-block text-left shadow-sm">
                    <strong>Interactive Insight:</strong> Use the slider to adjust the "Task Difficulty" (Error Rate). Notice how the Learning Rate (Adaptation) peaks not at zero errors, but at a specific challenge point.
                </div>
            </div>

            <div class="flex flex-col lg:flex-row gap-10 items-stretch max-w-6xl mx-auto">
                <!-- Controls -->
                <div class="w-full lg:w-1/3 bg-white p-8 rounded-2xl shadow-lg border border-stone-200 flex flex-col justify-center">
                    <label class="block text-sm font-bold text-stone-800 mb-4 uppercase tracking-wider">Task Difficulty</label>
                    <input type="range" min="0" max="100" value="15" class="w-full h-3 bg-stone-200 rounded-lg appearance-none cursor-pointer accent-teal-600 mb-3" id="errorSlider">
                    
                    <div class="flex justify-between text-xs text-stone-500 font-medium mb-8">
                        <span>Trivial (0%)</span>
                        <span>Impossible (100%)</span>
                    </div>

                    <div class="space-y-6 flex-grow">
                        <div class="flex justify-between items-end border-b border-stone-100 pb-3">
                            <span class="text-stone-500 text-sm font-medium">Error Rate</span>
                            <span id="errorDisplay" class="text-3xl font-bold text-stone-900 leading-none">15%</span>
                        </div>
                        <div class="flex justify-between items-end border-b border-stone-100 pb-3">
                            <span class="text-stone-500 text-sm font-medium">Neuroplasticity</span>
                            <span id="learningDisplay" class="text-2xl font-bold text-teal-600 leading-none">High</span>
                        </div>
                        <div class="p-4 bg-stone-50 rounded-lg text-stone-700 italic border border-stone-100" id="contextText">
                            "The Goldilocks Zone: Just enough failure to trigger cerebellar updates."
                        </div>
                    </div>
                </div>

                <!-- Chart -->
                <div class="w-full lg:w-2/3 flex items-center">
                    <div class="chart-container bg-white p-6 rounded-2xl shadow-lg border border-stone-200 w-full h-[450px]">
                        <canvas id="learningChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 4: Motor Adaptation Simulation -->
        <section id="simulation" class="page-section py-20">
            <div class="mb-10 text-center max-w-4xl mx-auto">
                <h2 class="text-3xl md:text-4xl font-bold text-stone-900 mb-6">Lab: Sensorimotor Adaptation</h2>
                <p class="text-lg text-stone-600">
                    This simulation mimics Shadmehr's classic robotic arm experiments. Control the cursor to hit the targets. <br/>
                    Once you feel comfortable, <strong>Enable Perturbation</strong> to rotate the visual feedback by 30¬∞ and experience your cerebellum actively updating its internal model.
                </p>
            </div>

            <div class="flex flex-col lg:flex-row gap-10 max-w-6xl mx-auto items-center">
                <!-- Game Canvas -->
                <div class="w-full lg:w-1/2 flex justify-center">
                    <div class="canvas-game-container shadow-2xl border-4 border-stone-300 relative" id="gameContainer">
                        <canvas id="motorCanvas" width="500" height="500" class="w-full h-full"></canvas>
                        <div id="startOverlay" class="absolute inset-0 flex flex-col items-center justify-center bg-stone-900/80 backdrop-blur-sm z-10 p-6 text-center">
                            <div class="text-white mb-6 text-lg">
                                <span class="font-bold text-teal-400">Goal:</span> Move quickly from the center to the orange targets.
                            </div>
                            <button onclick="startGame()" class="bg-teal-500 hover:bg-teal-400 text-white px-8 py-4 rounded-full font-bold shadow-[0_0_20px_rgba(20,184,166,0.5)] hover:scale-105 transition-all text-lg">Start Experiment</button>
                        </div>
                    </div>
                </div>

                <!-- Game Stats & Explanation -->
                <div class="w-full lg:w-1/2 space-y-6">
                    <div class="bg-white p-8 rounded-2xl shadow-lg border border-stone-200">
                        <h3 class="font-bold text-xl mb-6 text-stone-800 border-b pb-4">Live Telemetry</h3>
                        <div class="grid grid-cols-2 gap-6 mb-6">
                            <div class="bg-stone-50 p-4 rounded-xl border border-stone-100">
                                <div class="text-xs text-stone-400 uppercase tracking-widest font-bold mb-1">Phase</div>
                                <div id="phaseDisplay" class="font-bold text-teal-600 text-lg">Baseline</div>
                            </div>
                            <div class="bg-stone-50 p-4 rounded-xl border border-stone-100">
                                <div class="text-xs text-stone-400 uppercase tracking-widest font-bold mb-1">Trials</div>
                                <div id="trialDisplay" class="font-bold text-stone-900 text-2xl">0</div>
                            </div>
                            <div class="bg-stone-50 p-4 rounded-xl border border-stone-100">
                                <div class="text-xs text-stone-400 uppercase tracking-widest font-bold mb-1">Last Error</div>
                                <div id="lastErrorDisplay" class="font-bold text-amber-500 text-2xl">0¬∞</div>
                            </div>
                            <div class="bg-stone-50 p-4 rounded-xl border border-stone-100">
                                <div class="text-xs text-stone-400 uppercase tracking-widest font-bold mb-1">Model Accuracy</div>
                                <div id="adaptationDisplay" class="font-bold text-stone-900 text-2xl">100%</div>
                            </div>
                        </div>
                        
                        <button onclick="togglePerturbation()" id="perturbBtn" class="w-full py-4 rounded-xl border-2 border-amber-400 text-amber-700 font-bold hover:bg-amber-50 hover:shadow-md transition-all hidden text-lg">
                            ‚ö†Ô∏è Enable Perturbation (Force Field)
                        </button>
                    </div>

                    <div class="bg-teal-50 border border-teal-100 p-6 rounded-2xl shadow-sm">
                        <h4 class="font-bold text-teal-800 mb-3 text-lg flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            The Science
                        </h4>
                        <p class="text-teal-900 mb-3 leading-relaxed">
                            When perturbation is active, your brain experiences a <strong>Sensory Prediction Error</strong>. You command your hand to move straight, but your eyes see it move at an angle.
                        </p>
                        <p class="text-teal-900 leading-relaxed">
                            Over successive trials, your Cerebellum automatically adjusts its internal map, forcing you to unconsciously aim in the opposite direction to hit the target.
                        </p>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-stone-900 text-stone-400 py-12 mt-12 border-t border-stone-800">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="mb-4 text-stone-300 font-medium text-lg">The Neuro-Motor Lab</p>
            <p class="text-sm text-stone-500 max-w-2xl mx-auto leading-relaxed">
                Generated for educational purposes exploring Motor Control Science. Concepts based on the computational theories of Reza Shadmehr (JHU) and the emergent perspectives of Ecological Dynamics.
            </p>
        </div>
    </footer>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- Mobile Menu Toggle ---
        function toggleMobileMenu() {
            document.getElementById('mobile-menu').classList.toggle('hidden');
        }

        // --- ScrollSpy Navigation Logic ---
        function setupScrollSpy() {
            const sections = document.querySelectorAll('.page-section');
            const navLinks = document.querySelectorAll('.nav-btn');

            const observerOptions = {
                root: null,
                rootMargin: '-20% 0px -60% 0px', // Trigger when section is in upper middle of viewport
                threshold: 0
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        // Remove active class from all links
                        navLinks.forEach(link => {
                            link.classList.remove('nav-active', 'text-stone-900');
                            link.classList.add('text-stone-500');
                        });
                        
                        // Add active class to corresponding link
                        const id = entry.target.getAttribute('id');
                        const activeLinks = document.querySelectorAll(`.nav-btn[data-target="${id}"]`);
                        activeLinks.forEach(activeLink => {
                            activeLink.classList.add('nav-active');
                            activeLink.classList.remove('text-stone-500');
                        });
                    }
                });
            }, observerOptions);

            sections.forEach(section => {
                observer.observe(section);
            });
        }

        // --- Section 2: Theory Toggle Logic ---
        const theoryData = {
            computational: {
                title: "Information Processing",
                subtitle: "The Brain as a Simulator",
                icon: "üñ•Ô∏è",
                points: [
                    "<strong>Internal Models:</strong> The brain stores physics models of the body and world.",
                    "<strong>Prediction:</strong> Before moving, the brain predicts the sensory outcome (Forward Model).",
                    "<strong>Error Correction:</strong> Learning is driven by the difference between prediction and reality (Sensory Prediction Error).",
                    "<strong>Mechanism:</strong> Heavily relies on the Cerebellum for supervised learning."
                ],
                btnClass: "bg-white text-teal-700 shadow-sm",
                inactiveClass: "text-stone-500 hover:text-stone-700"
            },
            ecological: {
                title: "Ecological Dynamics",
                subtitle: "Perception-Action Coupling",
                icon: "üåø",
                points: [
                    "<strong>Direct Perception:</strong> Information is available in the environment; no need to 'process' it.",
                    "<strong>Affordances:</strong> We perceive opportunities for action (e.g., a chair 'affords' sitting).",
                    "<strong>Self-Organization:</strong> Movement emerges from constraints (Task, Organism, Environment).",
                    "<strong>No Internal Model:</strong> Rejects the idea of stored schemas. Control is online and continuous."
                ],
                btnClass: "bg-white text-amber-700 shadow-sm",
                inactiveClass: "text-stone-500 hover:text-stone-700"
            }
        };

        function switchTheory(type) {
            const content = theoryData[type];
            const list = document.getElementById('theory-points');
            const btnComp = document.getElementById('btn-comp');
            const btnEco = document.getElementById('btn-eco');

            // Animate transition
            document.getElementById('theory-content').classList.add('opacity-50', 'scale-[0.98]');
            
            setTimeout(() => {
                document.getElementById('theory-title').innerText = content.title;
                document.getElementById('theory-subtitle').innerText = content.subtitle;
                document.getElementById('theory-icon').innerText = content.icon;
                
                list.innerHTML = content.points.map(p => `<li class="flex items-start"><span class="mr-3 mt-1.5 text-teal-500 text-sm">‚ñ∂</span><span>${p}</span></li>`).join('');
                
                document.getElementById('theory-content').classList.remove('opacity-50', 'scale-[0.98]');
            }, 250);

            // Update Buttons
            if(type === 'computational') {
                btnComp.className = `px-8 py-3 rounded-full text-sm md:text-base font-semibold transition-all ${theoryData.computational.btnClass}`;
                btnEco.className = `px-8 py-3 rounded-full text-sm md:text-base font-semibold transition-all ${theoryData.ecological.inactiveClass}`;
            } else {
                btnEco.className = `px-8 py-3 rounded-full text-sm md:text-base font-semibold transition-all ${theoryData.ecological.btnClass}`;
                btnComp.className = `px-8 py-3 rounded-full text-sm md:text-base font-semibold transition-all ${theoryData.computational.inactiveClass}`;
            }
        }

        // --- Section 3: Chart.js Learning Curve ---
        let learningChart = null;

        function initChart() {
            if(learningChart) return; 

            const ctx = document.getElementById('learningChart').getContext('2d');
            
            // Initial Data Generation
            const generateData = (peakError) => {
                const data = [];
                for(let i=0; i<=100; i+=2) {
                    let distance = Math.abs(i - peakError);
                    let learning = 100 * Math.exp(-(distance * distance) / (2 * 250)); // standard deviation
                    if (i > 70) learning = learning * 0.4; // Penalty for extreme frustration/noise
                    data.push({x: i, y: learning});
                }
                return data;
            };

            Chart.defaults.font.family = "'Inter', sans-serif";
            Chart.defaults.color = '#78716c';

            learningChart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'Rate of Synaptic Change (Learning)',
                        data: generateData(20), // Peak at 20%
                        borderColor: '#0d9488',
                        backgroundColor: 'rgba(13, 148, 136, 0.15)',
                        borderWidth: 4,
                        tension: 0.4,
                        fill: true,
                        pointRadius: 0,
                        pointHoverRadius: 0,
                        pointHitRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'none'
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            title: { display: true, text: 'Error Probability (%)', font: {weight: 'bold'} },
                            min: 0,
                            max: 100,
                            grid: { display: false }
                        },
                        y: {
                            title: { display: true, text: 'Learning Magnitude', font: {weight: 'bold'} },
                            beginAtZero: true,
                            max: 110,
                            grid: { borderDash: [4, 4], color: '#e7e5e4' },
                            ticks: { display: false } // hide y numbers as it's abstract
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false }
                    }
                }
            });

            // Slider Listener
            document.getElementById('errorSlider').addEventListener('input', function(e) {
                const val = parseInt(e.target.value);
                document.getElementById('errorDisplay').innerText = val + "%";
                
                // Update text context
                const contextText = document.getElementById('contextText');
                const learnDisplay = document.getElementById('learningDisplay');
                
                if (val < 10) {
                    contextText.innerText = "Too Easy. Predictions are perfect. No prediction error = No neuroplasticity.";
                    learnDisplay.innerText = "Minimal";
                    learnDisplay.className = "text-2xl font-bold text-stone-400 leading-none";
                } else if (val >= 10 && val <= 30) {
                    contextText.innerText = "The Sweet Spot! Just enough failure to trigger robust cerebellar updates.";
                    learnDisplay.innerText = "Maximum";
                    learnDisplay.className = "text-2xl font-bold text-teal-600 leading-none";
                } else if (val > 30 && val < 60) {
                    contextText.innerText = "Challenging. Learning occurs, but sensory noise is increasing.";
                    learnDisplay.innerText = "Moderate";
                    learnDisplay.className = "text-2xl font-bold text-amber-500 leading-none";
                } else {
                    contextText.innerText = "Too Hard. The brain cannot find the signal in the noise. Frustration sets in.";
                    learnDisplay.innerText = "Low (Noise)";
                    learnDisplay.className = "text-2xl font-bold text-red-500 leading-none";
                }

                const theoreticalData = generateData(20); 
                let userY = 0;
                
                let distance = Math.abs(val - 20);
                userY = 100 * Math.exp(-(distance * distance) / (2 * 250));
                if (val > 70) userY *= 0.4;

                learningChart.data.datasets[0].data = theoreticalData;
                
                // Add "You are Here" point
                learningChart.data.datasets[1] = {
                    label: 'Current Task State',
                    data: [{x: val, y: userY}],
                    backgroundColor: val > 60 ? '#ef4444' : (val >= 10 && val <= 30) ? '#0d9488' : '#f59e0b',
                    borderColor: '#fff',
                    borderWidth: 3,
                    pointRadius: 10,
                    type: 'scatter'
                };
                
                learningChart.update();
            });
            
            // Trigger initial update
            document.getElementById('errorSlider').dispatchEvent(new Event('input'));
        }

        // --- Section 4: Motor Adaptation Simulation (Canvas) ---
        const canvas = document.getElementById('motorCanvas');
        const ctx = canvas.getContext('2d');
        
        let gameState = {
            active: false,
            phase: 'baseline', 
            trials: 0,
            cursor: { x: 250, y: 250 },
            mouse: { x: 250, y: 250 },
            target: null, 
            center: { x: 250, y: 250, radius: 25 },
            perturbationAngle: 0, 
            targetAngle: 0,
            accuracyHistory: []
        };

        function startGame() {
            document.getElementById('startOverlay').classList.add('hidden');
            document.getElementById('perturbBtn').classList.remove('hidden');
            gameState.active = true;
            gameState.trials = 0;
            gameState.accuracyHistory = [];
            requestAnimationFrame(gameLoop);
        }

        function togglePerturbation() {
            const btn = document.getElementById('perturbBtn');
            if(gameState.phase === 'baseline') {
                gameState.phase = 'perturbation';
                gameState.perturbationAngle = 30 * (Math.PI / 180); 
                btn.innerHTML = "üîÑ Disable Perturbation";
                btn.classList.replace('text-amber-700', 'text-stone-700');
                btn.classList.replace('border-amber-400', 'border-stone-400');
                
                document.getElementById('phaseDisplay').innerText = "PERTURBED (30¬∞)";
                document.getElementById('phaseDisplay').className = "font-bold text-amber-500 text-lg";
                
                // Reset stats for new phase
                gameState.trials = 0;
                document.getElementById('trialDisplay').innerText = "0";
                
            } else {
                gameState.phase = 'baseline';
                gameState.perturbationAngle = 0;
                btn.innerHTML = "‚ö†Ô∏è Enable Perturbation (Force Field)";
                btn.classList.replace('text-stone-700', 'text-amber-700');
                btn.classList.replace('border-stone-400', 'border-amber-400');

                document.getElementById('phaseDisplay').innerText = "Baseline";
                document.getElementById('phaseDisplay').className = "font-bold text-teal-600 text-lg";
                
                gameState.trials = 0;
                document.getElementById('trialDisplay').innerText = "0";
            }
        }

        // Input handling - accurately map browser coordinates to internal canvas resolution
        function getMousePos(evt) {
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            return {
                x: (evt.clientX - rect.left) * scaleX,
                y: (evt.clientY - rect.top) * scaleY
            };
        }

        canvas.addEventListener('mousemove', (e) => {
            if(!gameState.active) return;
            const pos = getMousePos(e);
            gameState.mouse.x = pos.x;
            gameState.mouse.y = pos.y;
        });

        canvas.addEventListener('touchmove', (e) => {
            if(!gameState.active) return;
            e.preventDefault();
            const pos = getMousePos(e.touches[0]);
            gameState.mouse.x = pos.x;
            gameState.mouse.y = pos.y;
        }, {passive: false});

        function gameLoop() {
            if(!gameState.active) return;
            update();
            drawCanvas();
            requestAnimationFrame(gameLoop);
        }

        function update() {
            // Apply rotation matrix for perturbation
            const dx = gameState.mouse.x - gameState.center.x;
            const dy = gameState.mouse.y - gameState.center.y;
            
            const cos = Math.cos(gameState.perturbationAngle);
            const sin = Math.sin(gameState.perturbationAngle);
            
            const rx = dx * cos - dy * sin;
            const ry = dx * sin + dy * cos;

            gameState.cursor.x = gameState.center.x + rx;
            gameState.cursor.y = gameState.center.y + ry;

            const distToCenter = Math.hypot(gameState.cursor.x - gameState.center.x, gameState.cursor.y - gameState.center.y);

            // Logic Flow
            if (!gameState.target) {
                // Wait for player to return to center
                if (distToCenter < gameState.center.radius) {
                    spawnTarget();
                }
            } else {
                const distToTarget = Math.hypot(gameState.cursor.x - gameState.target.x, gameState.cursor.y - gameState.target.y);
                
                if (distToTarget < 20) {
                    completeTrial(true);
                } else if (distToCenter > 210) { 
                    completeTrial(false);
                }
            }
        }

        function spawnTarget() {
            const angle = Math.random() * Math.PI * 2;
            gameState.targetAngle = angle; 
            gameState.target = {
                x: gameState.center.x + Math.cos(angle) * 180,
                y: gameState.center.y + Math.sin(angle) * 180
            };
        }

        function completeTrial(hit) {
            gameState.trials++;
            document.getElementById('trialDisplay').innerText = gameState.trials;
            
            // Calculate angular error at point of crossing threshold
            const cursorAngle = Math.atan2(gameState.cursor.y - gameState.center.y, gameState.cursor.x - gameState.center.x);
            let error = cursorAngle - gameState.targetAngle;
            
            // Normalize angle to -PI to PI
            if (error > Math.PI) error -= 2 * Math.PI;
            if (error < -Math.PI) error += 2 * Math.PI;
            
            const errorDeg = Math.abs(Math.round(error * 180 / Math.PI));
            document.getElementById('lastErrorDisplay').innerText = errorDeg + "¬∞";
            
            // Calculate pseudo "Model Accuracy"
            let trialAccuracy = Math.max(0, 100 - (errorDeg * 2.5));
            if(gameState.phase === 'baseline') trialAccuracy = 100; // Force 100 for baseline demo purposes

            // Simple moving average for smoothing
            gameState.accuracyHistory.push(trialAccuracy);
            if(gameState.accuracyHistory.length > 5) gameState.accuracyHistory.shift();
            
            const avgAcc = Math.round(gameState.accuracyHistory.reduce((a,b) => a+b, 0) / gameState.accuracyHistory.length);
            
            const accEl = document.getElementById('adaptationDisplay');
            accEl.innerText = avgAcc + "%";
            
            if(avgAcc < 50) accEl.className = "font-bold text-red-500 text-2xl";
            else if(avgAcc < 85) accEl.className = "font-bold text-amber-500 text-2xl";
            else accEl.className = "font-bold text-teal-600 text-2xl";

            // Reset for next trial
            gameState.target = null;
        }

        function drawCanvas() {
            // Clear Background
            ctx.fillStyle = "#e7e5e4";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw Target Rings (Background guide)
            ctx.beginPath();
            ctx.arc(gameState.center.x, gameState.center.y, 180, 0, Math.PI * 2);
            ctx.strokeStyle = "rgba(168, 162, 158, 0.3)";
            ctx.lineWidth = 1;
            ctx.stroke();

            // Draw Center Home
            ctx.beginPath();
            ctx.arc(gameState.center.x, gameState.center.y, gameState.center.radius, 0, Math.PI * 2);
            ctx.fillStyle = gameState.target ? "#d6d3d1" : "#0d9488"; // Teal if needs to return, Gray if active
            ctx.fill();
            ctx.strokeStyle = gameState.target ? "#a8a29e" : "#0f766e";
            ctx.lineWidth = 2;
            ctx.stroke();

            // Draw Target if exists
            if (gameState.target) {
                // Pulsing effect
                const pulse = Math.sin(Date.now() / 150) * 3;
                
                ctx.beginPath();
                ctx.arc(gameState.target.x, gameState.target.y, 15 + pulse, 0, Math.PI * 2);
                ctx.fillStyle = "#f59e0b"; // Amber
                ctx.fill();
                
                ctx.beginPath();
                ctx.arc(gameState.target.x, gameState.target.y, 8, 0, Math.PI * 2);
                ctx.fillStyle = "#fff";
                ctx.fill();
            } else if (gameState.active) {
                // Text prompt to return
                ctx.fillStyle = "#0f766e";
                ctx.font = "bold 14px Inter, sans-serif";
                ctx.textAlign = "center";
                ctx.fillText("RETURN", gameState.center.x, gameState.center.y - 35);
            }

            // Draw Cursor
            ctx.beginPath();
            ctx.arc(gameState.cursor.x, gameState.cursor.y, 8, 0, Math.PI * 2);
            ctx.fillStyle = "#292524"; // Stone-800
            ctx.fill();
            ctx.strokeStyle = "rgba(255,255,255,0.5)";
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // Draw Ghost/Trail effect for speed (Optional visual flair)
            if (gameState.target) {
                const dist = Math.hypot(gameState.cursor.x - gameState.center.x, gameState.cursor.y - gameState.center.y);
                if(dist > 30) {
                     ctx.beginPath();
                     ctx.moveTo(gameState.center.x, gameState.center.y);
                     ctx.lineTo(gameState.cursor.x, gameState.cursor.y);
                     ctx.strokeStyle = "rgba(41, 37, 36, 0.1)"; // faint line from center
                     ctx.lineWidth = 2;
                     ctx.stroke();
                }
            }
        }

        // --- Initialization ---
        window.addEventListener('DOMContentLoaded', () => {
            switchTheory('computational');
            initChart();
            setupScrollSpy();
            // Draw initial canvas state so it's not empty before clicking start
            drawCanvas();
        });

    </script>
</body>
</html>
